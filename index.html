<table id="map"></table>
<div id="result"></div>



<style>
table {
  border: 1px solid black;
}
td {
  width: 30px;
  height: 30px;
}
</style>




<script>
const map = [];
let agentPos;
let result = 0;

init();

setInterval(function() {
  let res = doStep();
  if (res.reward !== 0) {
    // console.log(res);
    let newPos = _findEmptyPos(); map[newPos.x][newPos.y] = res.reward;    
    result += res.reward;
  }
  drawMap();
}, 10);


function init() {
  let newPos;
  console.clear();
  for (let x=0; x<10; x++) {   map[x]=[];  for (let y=0; y<10; y++) { map[x][y] = 0; } }
  newPos = _findEmptyPos(); map[newPos.x][newPos.y] = -1;
  newPos = _findEmptyPos(); map[newPos.x][newPos.y] = -1;
  newPos = _findEmptyPos(); map[newPos.x][newPos.y] = -1;
  newPos = _findEmptyPos(); map[newPos.x][newPos.y] = 1;
  newPos = _findEmptyPos(); map[newPos.x][newPos.y] = 1;
  newPos = _findEmptyPos(); map[newPos.x][newPos.y] = 1;
  agentPos = _findEmptyPos(); map[agentPos.x][agentPos.y] = 0.5;
  drawMap();
  console.log(map);  
}  

function doStep() {
    let action = getAction();
    let reward = 0;
    //console.log(action);
    switch(action) {
      case 0: // left 
        if (agentPos.y > 0) {
          map[agentPos.x][agentPos.y] = 0;
          agentPos.y = agentPos.y - 1;
          reward = map[agentPos.x][agentPos.y];
          //console.log(1111, reward,agentPos);
          map[agentPos.x][agentPos.y] = 0.5;
        }
        break;
      case 1: // down
        if (agentPos.x < 9) {
          map[agentPos.x][agentPos.y] = 0;
          agentPos.x = agentPos.x + 1;
          reward = map[agentPos.x][agentPos.y];
          //console.log(22222, reward, agentPos);
          map[agentPos.x][agentPos.y] = 0.5;
        }
        break;
      case 2: // right
        if (agentPos.y < 9) {
          map[agentPos.x][agentPos.y] = 0;
          agentPos.y = agentPos.y + 1;
          reward = map[agentPos.x][agentPos.y];
          //console.log(3333, reward,agentPos);

          map[agentPos.x][agentPos.y] = 0.5;
        }
        break;
      case 3: // up
        if (agentPos.x > 0) {
          map[agentPos.x][agentPos.y] = 0;
          agentPos.x = agentPos.x - 1;
          reward = map[agentPos.x][agentPos.y];
          //console.log(44444, reward,agentPos);
          map[agentPos.x][agentPos.y] = 0.5;
        }
        break;
    }
  
    return {state: map, action, reward};
  
}

function getAction() {
  return Math.floor(Math.random()*4);
}

function drawMap() {
  var html = '';
  for (let x=0; x<10; x++) {
    html += '<tr>';
    for (let y=0; y<10; y++) {
       switch(map[x][y]) {
         case 0   : html += '<td> </td>'; break;
         case -1  : html += '<td style="color:#F00;">X</td>'; break;
         case 1   : html += '<td style="color:#0C0;">@</td>'; break;
         case 0.5 : html += '<td>:)</td>'; break;
       }
    }
    html += '</tr>\n';
  }
  //console.log(html);
  document.getElementById('map').innerHTML = html;
  document.getElementById('result').innerHTML = result;
}

function _findEmptyPos(){
  let x,y;
  do {
    x = Math.floor(Math.random() * 10);
    y = Math.floor(Math.random() * 10);         
  } while (map[x][y] !== 0);
  return {x, y};
}

</script>
